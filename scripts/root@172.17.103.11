#!/bin/bash

export mass_commander_base_dir="/root/mass-commander"
export runtime_files_dir="$mass_commander_base_dir/runtime-files"
export sftp_username="sftpuser"
export sftp_server_ip="192.168.122.254"
export sftp_directory="/data"

commands_to_run_file_fetcher() {
	echo "sftp $sftp_username@$sftp_server_ip<<EOF" >> $runtime_files_dir/commands-to-run-file-fetcher
	echo "cd $runtime_files_dir/" >> $runtime_files_dir/commands-to-run-file-fetcher
	echo "get $sftp_directory/commands-to-run-for-client" >> $runtime_files_dir/commands-to-run-file-fetcher
	echo "EOF" >> $runtime_files_dir/commands-to-run-file-fetcher
	echo "cd -" >> $runtime_files_dir/commands-to-run-file-fetcher

	source $runtime_files_dir/commands-to-run-file-fetcher
}

command_output_file_ensurer() {
	if [ -f $runtime_files_dir/command-output ]; then
		rm $runtime_files_dir/command-output
		touch $runtime_files_dir/command-output
	else
		touch $runtime_files_dir/command-output
	fi
}

directory_ensurer() {
	directory_name="$1"

	if [ -d $directory_name ]; then
		rm -r $directory_name
		mkdir $directory_name
	else
		mkdir $directory_name
	fi
}


directory_ensurer "$runtime_files_dir"

command_output_file_ensurer
tail -f -n +1 $runtime_files_dir/command-output &

commands_to_run_file_fetcher
source $runtime_files_dir/commands-to-run-for-client
